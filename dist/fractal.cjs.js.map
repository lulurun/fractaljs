{"version":3,"file":"fractal.cjs.js","sources":["../src/class.js","../src/pubsub.js","../src/config.js","../src/component.js","../src/router.js","../src/index.js"],"sourcesContent":["/* Simple JavaScript Inheritance\n * By John Resig http://ejohn.org/\n * MIT Licensed.\n */\n// Inspired by base2 and Prototype\nvar initializing = false, fnTest = /xyz/.test(function(){xyz;}) ? /\\b_super\\b/ : /.*/;\nvar Class = function(){};\nClass.extend = function(prop) {\n  var _super = this.prototype;\n  var callee = this.extend;\n\n  initializing = true;\n  var prototype = new this();\n  initializing = false;\n\n  for (var name in prop) {\n    prototype[name] = typeof prop[name] == \"function\" &&\n      typeof _super[name] == \"function\" && fnTest.test(prop[name]) ?\n      (function(name, fn){\n        return function() {\n          var tmp = this._super;\n          this._super = _super[name];\n\n          var ret = fn.apply(this, arguments);\n          this._super = tmp;\n\n          return ret;\n        };\n      })(name, prop[name]) :\n    prop[name];\n  }\n\n  var Class = function(){\n    if ( !initializing && this.init )\n      this.init.apply(this, arguments);\n  }\n\n  Class.prototype = prototype;\n  Class.prototype.constructor = Class;\n\n  Class.extend = this.extend;\n  return Class;\n};\n\nexport default Class\n","let topics = {}, seq = 0;\n\nexport default {\n  publish: function(topic, data, publisher) {\n    var subscribers = topics[topic];\n    for (var i in subscribers) subscribers[i].cb(topic, data, publisher);\n  },\n  subscribe: function(topic, cb, subscriber) {\n    console.debug(\"subscribe\", topic);\n    if (!topics[topic]) topics[topic] = [];\n    var token = ++seq;\n    topics[topic].push({\n      token: token,\n      subscriber: subscriber,\n      cb: cb\n    });\n    return token;\n  },\n  unsubscribe: function(topic, token) {\n    console.debug(\"unsubscribe\", topic);\n    if (!(topic in topics)) return;\n    var subscribers = topics[topic];\n    for (var i in subscribers) {\n      if (subscribers[i].token === token) {\n        subscribers.splice(i, 1);\n        break;\n      }\n    }\n    if (subscribers.length === 0) delete topics[topic];\n  },\n  getSubscribers: function(topic) {\n    if (!(topic in topics)) return [];\n    return topics[topic].map(function(v){ return v.subscriber; });\n  },\n};\n\n","import Pubsub from './pubsub'\n\nexport default {\n  compile: function(text) { return text; },\n  render: function(template, data) {},\n  Pubsub: Pubsub,\n  require: {\n    // component: require.context('./component', false, /^\\.\\/.*\\.js$/),\n    // template: require.context('./template', false, /^\\.\\/.*\\.html$/),\n  },\n}\n","import Class from './class'\nimport Config from './config'\n\nconst COMPONENT_ATTR = 'f-component'\nlet knownComponents = {};\nlet knownTemplates = {};\n\nexport const Component = Class.extend({\n  init: function(name, $container) {\n    this.name = name;\n    this.$container = $container;\n    this.complete = false;\n    this.subTokens = {};\n    this.$ = this.$container.find.bind(this.$container);\n    this.$container.on('destroyed', this.destroyed.bind(this));\n\n    if (!this.template) {\n      this.template = getTemplate(this.templateName || this.name);\n    }\n  },\n  getData: function(cb, param) {\n    if (this.data && typeof(this.data) === 'function') this.data(cb, param);\n    else cb(this.data || {});\n  },\n  render: function(data, template, cb, param) {\n    this.$container.html(Config.render(template, data));\n    cb();\n  },\n  rendered: function(param){},\n  loadChildren: function(cb, param) {\n    build(this.$container, param, cb);\n  },\n  loaded: function(cb, param){\n    cb();\n  },\n  destroyed: function(param){\n    for (var topic in this.subTokens) Config.Pubsub.unsubscribe(this.subTokens[topic]);\n  },\n  // main entry\n  load: function(param, cb) {\n    param = param || {};\n    console.time('Component.' + this.name);\n    this.complete = false;\n    this.getData(data => {\n      this.render(data, this.template, () => {\n        this.rendered(param);\n        this.loadChildren(() => {\n          this.complete = true;\n          this.loaded(() => {\n            console.timeEnd('Component.' + this.name);\n            this.$container.removeAttr(COMPONENT_ATTR);\n          }, param)\n        }, param)\n      }, param)\n    }, param)\n  },\n  // pubsub\n  publish: function(topic, data) {\n    Config.Pubsub.publish(topic, data, this);\n  },\n  subscribe: function(topic, cb) {\n    this.subTokens[topic] = Config.Pubsub.subscribe(topic, cb, this);\n  },\n});\n\nexport function build($root, param, cb){\n  let els = $root.find('[' + COMPONENT_ATTR + ']');\n  if (!els.length) return cb();\n\n  let complete = 0;\n  els.each((i, el) => {\n    let $container = $(el);\n    let name = $container.attr(COMPONENT_ATTR);\n    let Class = getComponent(name);\n    let c = new Class(name, $container);\n    c.load(param, () => {\n      if (++complete === len) cb();\n    });\n  });\n}\n\nfunction getTemplate(name) {\n  if (name in knownTemplates){\n    return knownTemplates[name];\n  } else {\n    let template = Config.require.template(\"./\" + name + \".html\");\n    if (template) {\n      if (Config.compile) {\n        template = Config.compile(template);\n      }\n      knownTemplates[name] = template;\n      return template;\n    }\n  }\n  console.error(\"Template not found: \" + name);\n  return \"\";\n}\n\nfunction getComponent(name) {\n  if (name in knownComponents) {\n    return knownComponents[name];\n  } else {\n    let Class = Config.require.component(\"./\" + name);\n    if (Class) {\n      knownComponents[name] = Class;\n      return Class;\n    }\n  }\n  console.error(\"Component not found: \" + name);\n  return Component;\n}\n\nexport function define(name, props, base) {\n  var c = (base || Component).extend(props || {});\n  knownComponents[name] = c;\n  return c;\n}\n\n","import {Component} from './component'\nimport Config from './config'\n\nconst _RE = /^#([0-9a-zA-Z_\\-\\/\\.]+)/\nlet getComponentName = function(hash) {\n  let match = _RE.exec(hash);\n  return (match && match[1]) || \"\";\n};\n\nexport default Component.extend({\n  template: '{{#name}}<div f-component=\"{{name}}\" />{{/name}}' +\n    '{{^name}}`DefaultComponent` is not defined{{/name}}',\n  current: getComponentName(location.hash),\n  init: function(name, $container) {\n    this._super(name, $container);\n    this.subscribe(\"onpopstate\", (topic, hash) => {\n      let component = getComponentName(hash);\n      if (this.current != component) {\n        this.current = component;\n        this.load();\n      }\n    });\n  },\n  data: function(cb, param) {\n    cb({\n      name: this.current || this.DefaultComponent\n    });\n  },\n});\n\nwindow.onpopstate = function(){\n  Config.Pubsub.publish(\"onpopstate\", location.hash);\n};\n\n","import {define, build} from './component'\nimport Config from './config'\nimport Router from './router'\n\nexport default {\n  component: define,\n  Router: Router,\n  init: function(options) {\n    for (let k in Config) {\n      if (options[k]) Config[k] = options[k];\n    }\n  },\n  build: function($root, cb) {\n    build($root, {}, function(){\n      if (cb) cb();\n    });\n  },\n  Pubsub: Config.Pubsub,\n}\n\n"],"names":[],"mappings":"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"}